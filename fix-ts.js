const fs = require("fs"); const path = require("path"); const dirs = ["./src/service", "./src/controller"]; dirs.forEach(dir => { const files = fs.readdirSync(dir); files.forEach(file => { if (file.endsWith(".ts")) { const filePath = path.join(dir, file); let content = fs.readFileSync(filePath, "utf8"); let modified = false; if (content.match(/totalPages:\s*Math\.ceil\(total \/ limit\)/)) { content = content.replace(/totalPages:\s*Math\.ceil\(total \/ limit\)/g, "totalPages: limit ? Math.ceil(total / limit) : 1"); modified = true; } if (content.match(/limit: Number\(limit\),\s*totalPages/)) { content = content.replace(/limit: Number\(limit\),/g, "limit: limit ? Number(limit) : undefined,"); modified = true; } if (content.match(/limit: parseInt\(limit as string\)/)) { content = content.replace(/limit: parseInt\(limit as string\)/g, "limit: limit ? parseInt(limit as string) : undefined"); modified = true; } if (content.match(/limit: Number\(limit \?\? 10\)/)) { content = content.replace(/limit: Number\(limit \?\? 10\)/g, "limit: limit ? Number(limit) : undefined"); modified = true; } if (content.match(/skip = \(page - 1\) \* limit/)) { content = content.replace(/skip = \(page - 1\) \* limit/g, "skip = (page && limit) ? (page - 1) * limit : undefined"); modified = true; } if (modified) { fs.writeFileSync(filePath, content); console.log("Fixed: " + filePath); } } }); });
